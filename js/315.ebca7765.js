"use strict";(self["webpackChunkhowshonginn"]=self["webpackChunkhowshonginn"]||[]).push([[315],{2990:function(e,a,l){l.r(a),l.d(a,{default:function(){return A}});var t=l(6252),n=l(2262),i=l(3577),o=l(9963),s=l(3370),r=l(2062),c=l(3972),u=l(409),d=l(6493),v=l(9992),g=l(3621),p=l(9669),m=l.n(p),f=l(9957),x=l(2201);const h=e=>((0,t.dD)("data-v-d14cc832"),e=e(),(0,t.Cn)(),e),b={class:"overflow-x-hidden py-20 md:pt-34 md:pb-20"},w={class:"container"},y={class:"mb-8 flex w-full items-center justify-center"},_={class:"hidden md:inline"},k={class:"relative"},C={class:"ml-2 font-mono text-xl font-bold uppercase text-secondary-dark md:text-2xl"},H=h((()=>(0,t._)("div",{class:"mb-6 border-b-8 border-double border-b-primary-dark"},null,-1))),I={class:"flex items-center justify-center gap-x-6 px-3"},j=h((()=>(0,t._)("span",{class:"inline xl:hidden"},"上一步",-1))),P=h((()=>(0,t._)("span",{class:"inline xl:hidden"},"下一步",-1))),z=["onClick"],T=h((()=>(0,t._)("span",{class:"inline lg:hidden"},"完成",-1))),W={class:"z-5 text-3xl font-bold tracking-widest text-primary-dark md:text-4xl"};var D={__name:"EditView",setup(e){const a=(0,x.yj)(),l=(0,n.iH)({}),p=(0,n.iH)([]),h=(0,n.iH)([]),D=(0,n.iH)(!1),Z=(0,n.iH)(!1),S=(0,n.iH)(""),A=(0,n.iH)(0),B=(0,n.iH)(0),F=(0,n.iH)([{name:"營地資訊",english:"Information",icon:"flag",active:!0},{name:"營地照片",english:"Pictures",icon:"images",active:!1},{name:"特色標籤",english:"Tags",icon:"tags",active:!1},{name:"畫面預覽",english:"Preview",icon:"display",active:!1}]),O=(0,n.iH)("left"),Y=[r.Z,c.Z,u.Z,d.Z];function E(e){O.value=e>A.value?"left":"right",F.value[A.value].active=!1,A.value=e,F.value[A.value].active=!0,window.scrollTo(0,80)}function M(e){O.value=e?"left":"right",F.value[A.value].active=!1,e?A.value+=1:A.value-=1,F.value[A.value].active=!0,B.value=e?A.value:B.value,window.scrollTo(0,80)}function U(){let e={info:"",type:"warning",bgColor:"#408560"};""===R.value.name?e.info="營地名稱不可空白":""===R.value.address?e.info="營地地址不可為空白":"undefined"===R.value.county?e.info="營地所在區域不可為空白":""===R.value.intro?e.info="營地簡介不可為空白":R.value.address.includes(R.value.county)||(e.info="地址與所在區域似乎不符合!請再次確認",e.type="danger",e.bgColor="#D28226"),""!==e.info?(E(0),(0,g.Yz)({title:"溫馨提醒",description:e.info},{type:e.type,position:"top-center",timeout:3e3,toastBackgroundColor:e.bgColor,showIcon:"true",transition:"zoom"})):(Z.value=!0,q())}async function q(){let e=!0,l=!0;const t={...R.value};let n=[...t.image.filter((e=>!e.startsWith("blob")))];if(t.image.some((e=>e.startsWith("blob")))){const a={method:"POST",url:"https://api.imgur.com/3/image",headers:{Authorization:"Bearer e3b8e719f5e3d08a7b9e75c7355dde23019bf3f5"}},l=[],i=t.originPicture.filter((e=>"object"===typeof e));for(let e=0;e<i.length;e++){let n=new FormData;n.append("image",i[e]),n.append("type","file"),n.append("title",t.name),n.append("album","0sbPdt7");let o={...a};o.data=n,l.push(o)}S.value="圖片上傳中...";for(let t of l)await m()(t).then((e=>{n.push(e.data.data.link)})).catch((()=>e=!1));n.length&&(t.image=n)}delete t.originPicture,S.value="資料上傳中...",await m().patch(`https://8ojgh9.deta.dev/campingPlace/${a.params.id}`,t).then((e=>e)).catch((()=>{l=!1})).finally((()=>{let a={info:"",type:"warning",bgColor:"#408560"};l?l&&!e?(a.info="編輯成功，但是圖片上傳有可能失敗了 QAQ",a.type="warning",a.bgColor="#D28226"):(a.info="編輯成功",a.type="success",a.bgColor="#408560"):(a.info="編輯失敗!!可能哪裡出了問題",a.type="danger",a.bgColor="#A31C3D"),f.Z.push({name:"home"}),(0,g.Yz)({title:"溫馨提醒",description:a.info},{type:a.type,position:"top-center",timeout:3e3,toastBackgroundColor:a.bgColor,showIcon:"true",transition:"zoom"})}))}const L=(0,n.iH)({}),Q=(0,n.iH)(["init_pic.jpg"]),$=(0,n.iH)([]),J=(0,n.iH)([]);function K(e){L.value=e}function V(e){let a=[...e];a.length||a.push("init_pic.jpg"),Q.value=[...e]}function G(e){$.value=[...e]}function N(e){J.value=[...e]}const R=(0,t.Fl)((()=>({...L.value,tags:[...J.value],image:[...Q.value],originPicture:[...$.value]})));return(0,t.bv)((()=>{m().get(`https://8ojgh9.deta.dev/campingPlace/${a.params.id}`).then((e=>{const{image:a,tags:t,...n}=e.data;l.value=n,p.value=a,h.value=t,D.value=!0})).catch((e=>console.error(e)))})),(e,a)=>{const r=(0,t.up)("BreadCrumb"),c=(0,t.up)("font-awesome-icon");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t._)("div",b,[(0,t._)("div",w,[(0,t.Wm)(r,{class:"mb-6"}),(0,t._)("ul",y,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(F.value,((e,a)=>((0,t.wg)(),(0,t.j4)((0,n.SU)(s.Z),{key:e.name,isActive:e.active,stepIndex:a,isEnd:a===F.value.length-1,maxStep:B.value,onJumpToStep:E},{icon:(0,t.w5)((()=>[(0,t.Wm)(c,{icon:["fa-solid","fa-"+e.icon],class:"md:mb-2"},null,8,["icon"])])),name:(0,t.w5)((()=>[(0,t._)("span",_,(0,i.zw)(e.name),1)])),_:2},1032,["isActive","stepIndex","isEnd","maxStep"])))),128))]),(0,t._)("section",k,[(0,t.Wm)(o.uT,{name:O.value,mode:"out-in"},{default:(0,t.w5)((()=>[((0,t.wg)(),(0,t.iD)("h2",{class:"mb-2 text-center text-2xl font-bold text-primary-dark md:text-3xl",key:F.value[A.value].name},[(0,t.Wm)(c,{icon:["fa-solid","fa-"+F.value[A.value].icon],class:"mr-4"},null,8,["icon"]),(0,t._)("span",null,(0,i.zw)(F.value[A.value].name),1),(0,t._)("span",C,(0,i.zw)(F.value[A.value].english),1)]))])),_:1},8,["name"]),H,(0,t.Wm)(o.uT,{name:O.value,mode:"out-in"},{default:(0,t.w5)((()=>[D.value?((0,t.wg)(),(0,t.j4)(t.Ob,{key:0},[((0,t.wg)(),(0,t.j4)((0,t.LL)(Y[A.value]),{class:"mb-10",onCampInfo:K,onCampPicture:V,onCampPictureOrigin:G,onCampTags:N,previewInfo:(0,n.SU)(R),existedInfo:l.value,existedImage:p.value,existedTags:h.value},null,40,["previewInfo","existedInfo","existedImage","existedTags"]))],1024)):(0,t.kq)("",!0)])),_:1},8,["name"]),(0,t._)("div",I,[(0,t._)("a",{href:"#",class:(0,i.C_)(["btn btn-danger lg:btn-large xl:btn-circle group xl:absolute xl:left-0 xl:top-72 xl:h-18 xl:w-18 xl:text-2xl xl:ring-2 xl:ring-danger-dark",{"invisible opacity-0":0===A.value}]),onClick:a[0]||(a[0]=(0,o.iM)((e=>M(!1)),["prevent"]))},[(0,t.Wm)(c,{icon:"fa-solid fa-angles-left",class:"mr-2 group-hover:animate-left xl:mr-0"}),j],2),(0,t.wy)((0,t._)("a",{href:"#",class:"btn btn-primary lg:btn-large xl:btn-circle group xl:absolute xl:top-72 xl:right-0 xl:h-18 xl:w-18 xl:text-2xl xl:ring-2 xl:ring-primary-dark",onClick:a[1]||(a[1]=(0,o.iM)((e=>M(!0)),["prevent"]))},[P,(0,t.Wm)(c,{icon:"fa-solid fa-angles-right",class:"ml-2 group-hover:animate-right xl:ml-0"})],512),[[o.F8,A.value!==F.value.length-1]]),(0,t.wy)((0,t._)("a",{href:"#",class:"btn btn-secondary lg:btn-large xl:btn-circle group xl:absolute xl:right-0 xl:top-72 xl:h-18 xl:w-18 xl:text-2xl xl:ring-2 xl:ring-secondary-dark",onClick:(0,o.iM)(U,["prevent"])},[T,(0,t.Wm)(c,{icon:"fa-solid fa-check",class:"ml-2 group-hover:animate-pulse lg:ml-0"})],8,z),[[o.F8,A.value===F.value.length-1]])])])])]),Z.value?((0,t.wg)(),(0,t.j4)((0,n.SU)(v.Z),{key:0,bgOpacity:"0.7"},{title:(0,t.w5)((()=>[(0,t._)("h2",W,(0,i.zw)(S.value),1)])),_:1})):(0,t.kq)("",!0)],64)}}},Z=l(3744);const S=(0,Z.Z)(D,[["__scopeId","data-v-d14cc832"]]);var A=S}}]);
//# sourceMappingURL=315.ebca7765.js.map